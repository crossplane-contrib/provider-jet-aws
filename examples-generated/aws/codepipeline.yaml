apiVersion: aws.aws.jet.crossplane.io/v1alpha1
kind: Codepipeline
metadata:
  name: example
spec:
  forProvider:
    artifactStore:
    - encryptionKey:
      - id: ${data.aws_kms_alias.s3kmskey.arn}
        type: KMS
      location: my-tf-test-bucket
      type: S3
    name: tf-test-pipeline
    roleArn: ${aws_iam_role.codepipeline_role.arn}
    stage:
    - action:
      - category: Source
        configuration:
          BranchName: main
          ConnectionArn: ${aws_codestarconnections_connection.example.arn}
          FullRepositoryId: my-organization/example
        name: Source
        outputArtifacts:
        - source_output
        owner: AWS
        provider: CodeStarSourceConnection
        version: "1"
      name: Source
    - action:
      - category: Build
        configuration:
          ProjectName: test
        inputArtifacts:
        - source_output
        name: Build
        outputArtifacts:
        - build_output
        owner: AWS
        provider: CodeBuild
        version: "1"
      name: Build
    - action:
      - category: Deploy
        configuration:
          ActionMode: REPLACE_ON_FAILURE
          Capabilities: CAPABILITY_AUTO_EXPAND,CAPABILITY_IAM
          OutputFileName: CreateStackOutput.json
          StackName: MyStack
          TemplatePath: build_output::sam-templated.yaml
        inputArtifacts:
        - build_output
        name: Deploy
        owner: AWS
        provider: CloudFormation
        version: "1"
      name: Deploy
  providerConfigRef:
    name: example
